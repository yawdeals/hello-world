<form script="runPageScript.js" theme="light">
  <label>MITRE ATT&amp;CK Framework</label>
  <description>Each number represents a piece of content. Follow the headlines 1, 2 and 3 to find and drill down into the content.</description>
  <init>
    <set token="chart_post_process">| lookup mitre_matrix_list "Tactic" AS "MITRE Tactic" OUTPUT Tactic_Order Matrix
    | where Matrix="Enterprise ATT&amp;CK"
| sort Tactic_Order
| fields - Tactic_Order Matrix
| rename "MITRE Tactic" AS "MITRE ATT&amp;CK Tactic"
    </set>

    <set token="Phase0LongName">Active</set>
    <set token="Phase1LongName">Available</set>
    <set token="Phase2LongName">Needs data</set>
    <set token="SelectedLongName">Selected</set>
    <set token="SelectedColor">F1C40F</set>
    <set token="deeplink_highlight">Yes</set>
    <set token="colorby">Total</set>
  </init>
  <search>
    <query>| inputlookup ColorScheme.csv WHERE Enabled="Yes"
| appendcols [
| inputlookup AppSettings.csv
| transpose 10 header_field=Key
| fields - column
]</query>
    <done>
      <condition match="'job.resultCount' &gt; 0">
        <set token="addsample"></set>
        <set token="replacewithsample"></set>
        <set token="y_field">Status</set>
        <set token="Phase0Color">$result.Phase0$</set>
        <set token="Phase1Color">$result.Phase1$</set>
        <set token="Phase2Color">$result.Phase2$</set>
        <set token="SelectedColor">$result.Selected$</set>
        <set token="Phase0LongName">$result.Phase0LongName$</set>
        <set token="Phase0ShortName">$result.Phase0ShortName$</set>
        <set token="Phase1LongName">$result.Phase1LongName$</set>
        <set token="Phase1ShortName">$result.Phase1ShortName$</set>
        <set token="Phase2LongName">$result.Phase2LongName$</set>
        <set token="Phase2ShortName">$result.Phase2ShortName$</set>
        <set token="SelectedLongName">$result.SelectedLongName$</set>
        <set token="SelectedShortName">$result.SelectedShortName$</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| makeresults count=1</query>
    <done>
      <condition match="$job.doneProgress$=1">
        <set token="x_field">$form.x_field$</set>
        <set token="chart_post_process">|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$form.x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
| lookup mitre_matrix_list "Tactic" AS "MITRE Tactic" OUTPUT Tactic_Order Matrix
| sort Tactic_Order
| where (Matrix="Enterprise ATT&amp;CK" AND "$form.x_field$"="MITRE Tactic") OR "$form.x_field$"!="MITRE Tactic"
| fields - Tactic_Order Matrix
| rename "MITRE Tactic" AS "MITRE ATT&amp;CK Tactic"
        </set>
      </condition>
    </done>
  </search>
  <search>
    <query>| rest splunk_server=local /services/apps/local | search disabled=0 title=*sankey*</query>
    <done>
      <condition match="'job.resultCount' == 0">
        <set token="nosankey">nosankey</set>
        <unset token="sankey">sankey</unset>
      </condition>
      <condition match="'job.resultCount' &gt; 0">
        <unset token="nosankey">nosankey</unset>
        <set token="sankey">sankey</set>
      </condition>
    </done>
  </search>
  <search id="data_sources_selected_filter_search">
    <query>
      | makeresults count=1
| eval data_sources=mvappend($datasource_selection$,"-")
| eval data_sources=mvfilter(NOT like('data_sources',"*"))
| eval data_sources=mvjoin(data_sources,"\",\"")
| rex mode=sed field=data_sources "s/,/) OR match('Data Source',/g"
| eval data_sources_selected_filter="match('Data Source',\"".data_sources."\")"
| fields data_sources_selected_filter
</query>
    <done>
      <condition match="$job.doneProgress$=1">
        <set token="data_sources_selected_filter">$result.data_sources_selected_filter$</set>
      </condition>
    </done>
  </search>
  <search>
    <query>| rest splunk_server=local /services/apps/local | search disabled=0 title=*radar*</query>
    <done>
      <condition match="'job.resultCount' == 0">
        <set token="noradar">noradar</set>
        <unset token="radar">radar</unset>
      </condition>
      <condition match="'job.resultCount' &gt; 0">
        <unset token="noradar">noradar</unset>
        <set token="radar">radar</set>
      </condition>
    </done>
  </search>
  <search id="usecase_base">
    <query>
        | sseanalytics
        | lookup use_cases.csv title AS "usecase" OUTPUT order_title AS use_case_order_title
        | eval "Use Case Orig"=if(isnull('usecase'),"Other",'usecase')
        | eval "Use Case"=if(isnull(use_case_order_title), "9_Other",use_case_order_title)
        | eval "Has Data"=if(data_available="Good" OR data_available="Mixed", "Yes", "No")
        | eval Status=case(
        'enabled'="Yes" AND 'Has Data'="Yes","$Phase0LongName$",
        'enabled'!="Yes" AND 'Has Data'="Yes","$Phase1LongName$",
        1=1,"$Phase2LongName$"
        )
        | eval App=displayapp, Enabled=enabled, Title=name, Journey=journey, "Data Source"=datasource, "Data Source Category"=data_source_categories_display
        | where (mitre_tactic_display!="" AND mitre_tactic_display!="None") OR (mitre_technique_display!="" AND mitre_technique_display!="None" AND mvcount(mitre_technique_display)&gt;0)
        | eval "MITRE Tactic"=if('mitre_tactic_display'="","-",'mitre_tactic_display'), "MITRE Technique"=mitre_technique_display, "MITRE Threat Group"=mitre_threat_groups
</query>
  </search>
  <search base="usecase_base">
    <query>
      | table mitre_matrix "MITRE Tactic" "MITRE Technique" Status "Data Source"
| eval mitre_tactic_matrix_merge=mvzip('MITRE Tactic',mitre_matrix,"::")
| mvexpand "mitre_tactic_matrix_merge"
| mvexpand "MITRE Technique"
| rex field=mitre_tactic_matrix_merge "(?&lt;MITRE_Tactic&gt;[^:]*)::(?&lt;MITRE_Matrix&gt;.*)"
| rename MITRE_Tactic AS "MITRE Tactic", MITRE_Matrix AS "MITRE Matrix"

| eval c="This filters out mappings that do not exists in reality. Solves the MV issue in sseanalytics"
| lookup mitre_matrix_list.csv Tactic AS "MITRE Tactic" Technique AS "MITRE Technique" OUTPUT Technique AS Mapped
| where isnotnull(Mapped)

| eval mitre_technique_datasource_merge=mvzip('MITRE Technique','Data Source',"::")
| eventstats count AS MITRE_Technique_Datasource_Total BY "mitre_technique_datasource_merge"
| eval mitre_technique_datasource_merge=mvzip('Data Source','MITRE_Technique_Datasource_Total',"::")
| eventstats count AS MITRE_Tactic_Total BY "MITRE Tactic"
| eventstats count AS MITRE_Technique_Total BY "MITRE Technique"
| eventstats count AS MITRE_Tactic_Technique_Total BY "MITRE Tactic" "MITRE Technique"
| stats delim=","
sum(eval(if(Status="$Phase0LongName$",1,0))) AS "$Phase0LongName$",
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
max(MITRE_Tactic_Total) AS MITRE_Tactic_Total,
max(MITRE_Technique_Total) AS MITRE_Technique_Total
max(MITRE_Tactic_Technique_Total) AS MITRE_Tactic_Technique_Total,
values(mitre_technique_datasource_merge) AS "Data Source"
BY "MITRE Tactic","MITRE Technique","MITRE Matrix"
| rename "MITRE *" AS *,"MITRE_*" AS *
| table Matrix Tactic Tactic_Total Technique Technique_Total $Phase0LongName$ "$Phase1LongName$" "$Phase2LongName$" "Data Source"
| outputlookup mitre_environment_count.csv
    </query>
  </search>
  <fieldset submitButton="false"></fieldset>
  <row>
    <panel>
      <html>
          <i data-translate-id="contentanalytics-i-mitrelink">For more details check the <a href="https://mitre-attack.github.io/attack-navigator/enterprise/" target="_blank">MITRE ATT&amp;CK Navigator.</a>
        </i>

      </html>
    </panel>
  </row>
  <row id="cs2">
    <panel>
      <single>
        <title>$Phase0LongName$</title>
        <search base="usecase_base">
          <query>| where Status="$Phase0LongName$"
| stats count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["#$Phase0Color$","#3c444d"]</option>
        <option name="rangeValues">[1000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Content ($Phase0LongName$)</option>
        <option name="useColors">1</option>
        <drilldown>
          <set token="form.phase">$Phase0LongName$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <single>
        <title>$Phase1LongName$</title>
        <search base="usecase_base">
          <query>| where Status="$Phase1LongName$"
| stats count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["#$Phase1Color$","#3c444d"]</option>
        <option name="rangeValues">[1000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Content ($Phase1LongName$)</option>
        <option name="useColors">1</option>
        <drilldown>
          <set token="form.phase">$Phase1LongName$</set>
        </drilldown>
      </single>
    </panel>
    <panel>
      <single>
        <title>$Phase2LongName$</title>
        <search base="usecase_base">
          <query>| where Status="$Phase2LongName$"
| stats count</query>
        </search>
        <option name="colorMode">block</option>
        <option name="drilldown">all</option>
        <option name="rangeColors">["#$Phase2Color$","#3c444d"]</option>
        <option name="rangeValues">[10000]</option>
        <option name="refresh.display">progressbar</option>
        <option name="underLabel">Content ($Phase2LongName$)</option>
        <option name="useColors">1</option>
        <drilldown>
          <set token="form.phase">$Phase2LongName$</set>
        </drilldown>
      </single>
    </panel>
  </row>
  <row id="tabs">
    <panel>
      <html>
      <h1 data-translate-id="contentanalytics-h1-availableContent">1. Available Content</h1>
          <p data-translate-id="contentanalytics-p-graphs">Click in the graphs below to filter on an area you want to highlight. </p>
      <ul id="tabs" class="nav nav-tabs">
                    <li class="active">
                        <a href="#" class="toggle-tab available_content" data-toggle="tab" data-tab-set="available_content" data-elements="row1_col1" data-token="row1_col1" data-translate-id="contentanalytics-li-mitremap">MITRE ATT&amp;CK Matrix</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab available_content" data-toggle="tab" data-tab-set="available_content" data-elements="row1_col2" data-token="row1_col2" data-translate-id="contentanalytics-li-chartview">Chart View</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab available_content" data-toggle="tab" data-tab-set="available_content" data-elements="row1_col3" data-token="row1_col3" data-translate-id="contentanalytics-li-radarview">Radar View</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab available_content" data-toggle="tab" data-tab-set="available_content" data-elements="row1_col4" data-token="row1_col4" data-translate-id="contentanalytics-li-sankeyview">Sankey View</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab available_content" data-toggle="tab" data-tab-set="available_content" data-elements="row1_col5,row1_col6,row1_col7,row1_col8" data-token="row1_col5" data-translate-id="contentanalytics-li-journeyview">Security Journey View</a>
                    </li>
				</ul>
    </html>
    </panel>
  </row>
    <row id="row1_col1">
    <panel>
      <input type="dropdown" token="colorby">
        <label>Color by</label>
        <choice value="Total">Total</choice>
        <default>Total</default>
        <fieldForLabel>Value</fieldForLabel>
        <fieldForValue>Value</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| search Key=Phase*LongName
| fields Value</query>
        </search>
      </input>
      <input type="dropdown" token="threat_group">
        <label>MITRE ATT&amp;CK Threat Group</label>
        <fieldForLabel>mitre_threat_groups</fieldForLabel>
        <fieldForValue>mitre_threat_groups</fieldForValue>
        <search>
          <query>| sseanalytics
| stats count by mitre_threat_groups
| where mitre_threat_groups!=""
| fields mitre_threat_groups</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <initialValue>*</initialValue>
      </input>
      <input type="multiselect" token="datasource_selection">
        <label>Highlight Data Source</label>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <valuePrefix>"</valuePrefix>
        <delimiter>,</delimiter>
        <valueSuffix>"</valueSuffix>
      </input>
        <input type="checkbox" token="show_content_available" searchWhenChanged="true">
        <label>Show Only Available Content</label>
        <choice value="true">Yes</choice>
        <default>false</default>
      </input>
        <input type="checkbox" token="show_popular_techniques" searchWhenChanged="true">
        <label>Show Only Popular Techniques</label>
        <choice value="true">Yes</choice>
        <default>false</default>
      </input>
      <table id="mitremaptable">
        <title>MITRE ATT&amp;CK Matrix</title>
        <search>
          <query>| mitremap popular_only="$show_popular_techniques$" content_available=$show_content_available$ groups="$threat_group$"
| foreach *
    [ | rex field="&lt;&lt;FIELD&gt;&gt;" "(?&lt;technique_temp&gt;.*) \("
    | eval Technique_nogroups=coalesce(technique_temp,'&lt;&lt;FIELD&gt;&gt;')
    | eval "&lt;&lt;FIELD&gt;&gt; Tactic" = "&lt;&lt;FIELD&gt;&gt;"
    | lookup mitre_environment_count.csv Technique AS Technique_nogroups, "Tactic" AS "&lt;&lt;FIELD&gt;&gt; Tactic" OUTPUT "Active" "Available" "Needs data" "Data Source"
    | eval "Data Source"=split('Data Source',",")
    | eval "Data Source"=mvfilter($data_sources_selected_filter$)
    | rex field="Data Source" "(?&lt;Data_Source&gt;[^:]*)::(?&lt;Data_Source_Count&gt;.*)"
    | rename Data_Source AS "Data Source"
    | eval Selected=if(in('Data Source',$datasource_selection$) , Data_Source_Count,0)
    | eval Selected=tonumber(coalesce(mvindex(Selected,0,0),0))+tonumber(coalesce(mvindex(Selected,1,1),0))+tonumber(coalesce(mvindex(Selected,2,2),0))+tonumber(coalesce(mvindex(Selected,3,3),0))+tonumber(coalesce(mvindex(Selected,4,4),0))+tonumber(coalesce(mvindex(Selected,5,5),0))+tonumber(coalesce(mvindex(Selected,6,6),0))
    | fields - Technique_nogroups technique_temp
    | eval count = coalesce(count, 1), temp = "t" + count, {temp}='&lt;&lt;FIELD&gt;&gt;', color="#00A9F8", colorby="$colorby$"

    | eval text='&lt;&lt;FIELD&gt;&gt;'
    | eval p0_count=coalesce(Active,0)
    | eval p1_count=coalesce(Available,0)
    | eval p2_count=coalesce('Needs data',0)
    | eval p3_count=coalesce('Selected',0)
    | eval total_count=p0_count+p1_count+p2_count
    | eval opacity=tostring(case(
        colorby="Active",p0_count/20,
        colorby="Available",p1_count/20,
        colorby="Needs data",p2_count/20,
        colorby="Total",total_count/20
        ))
    | eval tooltip="Active: ".p0_count."&lt;br /&gt;"."Available: ".p1_count."&lt;br /&gt;"."Needs data: ".p2_count."&lt;br /&gt;"."Total: ".total_count."&lt;br /&gt;"."Selected: ".p3_count
    | eval "&lt;&lt;FIELD&gt;&gt;" = if(text!="",mvappend(text,color,opacity,tooltip),null)
    | eval count = count + 1
        ]
        | fields - temp count Active Available "Needs data" tooltip *Tactic  color colorby opacity p0* p1* p2* t1 t2 t3 t4 t5 t6 t7 t8 t9 t10 t11 t12 t13 t14 t15 t16 t17 t18 text total_count "Data Source" Data_Source_Count Selected p3_count</query>
          <earliest>$earliest$</earliest>
          <latest>$latest$</latest>
        </search>
        <option name="count">35</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <eval token="form.MITRE_Technique">trim(mvindex(split(replace($click.value2$, ".{0,3}_.{0,3}_.{0,3}_",""),"("),0))</eval>
          <set token="form.highlight">*</set>
          <set token="form.MITRE_Tactic">$click.name2$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="row1_col2">
    <panel>
      <input type="dropdown" token="x_field">
        <label>Split by</label>
        <choice value="App">App</choice>
        <choice value="Data Source">Data Source</choice>
        <choice value="Data Source Category">Data Source Category</choice>
        <choice value="Use Case">Use Case</choice>
        <choice value="Journey">Journey</choice>
        <choice value="MITRE Tactic">ATT&amp;CK Tactic</choice>
        <choice value="MITRE Technique">ATT&amp;CK Technique</choice>
        <choice value="MITRE Threat Group">ATT&amp;CK Threat Group</choice>
        <default>MITRE Tactic</default>
        <change>
            <condition value="MITRE Tactic">
            <set token="chart_post_process">| lookup mitre_matrix_list "Tactic" AS "MITRE Tactic" OUTPUT Tactic_Order Matrix
| sort Tactic_Order
| where Matrix="Enterprise ATT&amp;CK"
| fields - Tactic_Order Matrix
| rename "MITRE Tactic" AS "MITRE ATT&amp;CK Tactic"
            </set>

          </condition>
          <condition value="MITRE Technique">
            <set token="chart_post_process">| lookup mitre_matrix_list "Technique" AS "MITRE Technique" OUTPUT Technique_Order Matrix
| sort Technique_Order
| where Matrix="Enterprise ATT&amp;CK"
| fields - Technique_Order Matrix
| rename "MITRE Technique" AS "MITRE ATT&amp;CK Technique"
            </set>
          </condition>
          <condition value="MITRE Threat Group">
            <set token="chart_post_process">
| rename "MITRE Threat Group" AS "MITRE ATT&amp;CK Threat Group"
            </set>
          </condition>
          <condition label="Use Case">
            <set token="chart_post_process">| append
[
| inputlookup use_cases.csv
| fields title order_title
| rename order_title AS "Use Case"
]
| stats first(*) AS * BY "Use Case"
| fields - "Use Case"
| rename title AS "Use Case"
| fillnull
|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
          <condition label="*">
            <set token="chart_post_process">|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="phase">
        <label>Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <fieldForLabel>LongName</fieldForLabel>
        <fieldForValue>LongName</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| rex field=Key "(?&lt;phase&gt;.*)(Long|Short)Name"
| stats first(Value) AS LongName, Last(Value) AS ShortName BY phase
| fields - phase</query>
        </search>
      </input>
      <input type="checkbox" token="show_recommended_only" searchWhenChanged="true">
        <label>Featured</label>
        <choice value="AND highlight=&quot;Yes&quot;">Yes</choice>
        <change>
          <eval token="form.highlight">if(isnull('form.show_recommended_only') OR NOT like('form.show_recommended_only',"%Yes%"), "*","Yes")</eval>
        </change>
        <default>AND 1=1</default>
        <delimiter> </delimiter>
      </input>
      <input type="checkbox" token="show_bookmarked_only" searchWhenChanged="true">
        <label>Bookmarked</label>
        <choice value="AND bookmark_status!=&quot;none&quot;">Yes</choice>
        <change>
          <eval token="form.bookmark_status">if(isnull('form.show_bookmarked_only') OR NOT like('form.show_bookmarked_only',"%none%"), "*","Yes")</eval>
        </change>
        <default>AND 1=1</default>
        <delimiter> </delimiter>
      </input>
      <input type="multiselect" token="datasource_selection">
        <label>Highlight Data Source</label>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <valuePrefix>"</valuePrefix>
        <delimiter>,</delimiter>
        <valueSuffix>"</valueSuffix>
      </input>
      <chart>
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "highlight"="$highlight$"
| where 1=1 $show_recommended_only$ $show_bookmarked_only$
| chart count over "$x_field$" By Status

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

$chart_post_process$
</query>
        </search>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsY.majorUnit">1</option>
        <option name="charting.axisTitleY.text">Use Cases</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <eval token="form.enabled">if($form.y_field$="Enabled" OR $form.y_field$="Enabled and Accelerated", $click.name2$,"*")</eval>
          <eval token="form.status">$click.name2$</eval>
          <eval token="form.phase">$click.name2$</eval>
          <eval token="form.sourcetype">if($form.x_field$="Sourcetype", $click.value$,"*")</eval>
          <eval token="form.datamodel">if($form.x_field$="Datamodel", $click.value$,"*")</eval>
          <eval token="form.AddOn">if($form.x_field$="AddOn", $click.value$,"*")</eval>
          <eval token="form.App">if($form.x_field$="App", $click.value$,"*")</eval>
          <eval token="form.usecase">if($form.x_field$="Use Case", $click.value$,"*")</eval>
          <eval token="form.datasource">if($form.x_field$="Data Source", $click.value$,"*")</eval>
          <eval token="form.datacategory">if($form.x_field$="Data Source Category", $click.value$,"*")</eval>
          <eval token="form.journey">if($form.x_field$="Journey", $click.value$,"*")</eval>
          <eval token="form.MITRE_Tactic">if($form.x_field$="MITRE Tactic", $click.value$,"*")</eval>
          <eval token="form.MITRE_Technique">if($form.x_field$="MITRE Technique", $click.value$,"*")</eval>
          <eval token="form.MITRE_Threat_Group">if($form.x_field$="MITRE Threat Group", $click.value$,"*")</eval>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row id="row1_col3">
    <panel depends="$radar$">
      <input type="dropdown" token="x_field">
        <label>Split by</label>
        <choice value="App">App</choice>
        <choice value="Data Source">Data Source</choice>
        <choice value="Use Case">Use Case</choice>
        <choice value="Journey">Journey</choice>
        <choice value="MITRE Tactic">ATT&amp;CK Tactic</choice>
        <choice value="MITRE Technique">ATT&amp;CK Technique</choice>
        <choice value="MITRE Threat Group">ATT&amp;CK Threat Group</choice>
        <default>MITRE Tactic</default>
        <change>
          <condition label="Use Case">
            <set token="chart_post_process">| append
[
| inputlookup use_cases.csv
| fields title order_title
| rename order_title AS "Use Case"
]
| stats first(*) AS * BY "Use Case"
| fields - "Use Case"
| rename title AS "Use Case"
| fillnull
|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
          <condition label="*">
            <set token="chart_post_process">|  foreach "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$"
[
    | eval "&lt;&lt;FIELD&gt;&gt;"=if(isnull('&lt;&lt;FIELD&gt;&gt;'), 0,'&lt;&lt;FIELD&gt;&gt;' )
]
| table "$x_field$" "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"</set>
          </condition>
        </change>
      </input>
      <input type="checkbox" token="show_recommended_only" searchWhenChanged="true">
        <label>Featured</label>
        <choice value="AND highlight=&quot;Yes&quot;">Yes</choice>
        <change>
          <eval token="form.highlight">if(isnull('form.show_recommended_only') OR NOT like('form.show_recommended_only',"%Yes%"), "*","Yes")</eval>
        </change>
        <default>AND 1=1</default>
        <delimiter> </delimiter>
      </input>
      <input type="checkbox" token="show_bookmarked_only" searchWhenChanged="true">
        <label>Bookmarked</label>
        <choice value="AND bookmark_status!=&quot;none&quot;">Yes</choice>
        <change>
          <eval token="form.bookmark_status">if(isnull('form.show_bookmarked_only') OR NOT like('form.show_bookmarked_only',"%none%"), "*","Yes")</eval>
        </change>
        <default>AND 1=1</default>
        <delimiter> </delimiter>
      </input>
      <input type="multiselect" token="datasource_selection">
        <label>Highlight Data Source</label>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <valuePrefix>"</valuePrefix>
        <delimiter>,</delimiter>
        <valueSuffix>"</valueSuffix>
      </input>
      <viz type="custom-radar-chart-viz.radar_chart">
        <title>(Requires Radar Viz)</title>
        <search base="usecase_base">
          <query>
                | eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
                | search "highlight"="$highlight$"
                | chart count over "$x_field$" By Status

                | eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
                | eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
                | fields - m
                | eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
                | rename "$SelectedLongName$_New" AS "$SelectedLongName$"

                $chart_post_process$
                | untable "$x_field$" key value
                | rename  "$x_field$" AS axis
                | eval keyColor=case(
                    key="$Phase0LongName$","#$Phase0Color$",
                    key="$Phase1LongName$","#$Phase1Color$",
                    key="$Phase2LongName$","#$Phase2Color$",
                    key="$SelectedLongName$","#$SelectedColor$"
                )</query>
        </search>
        <option name="custom-radar-chart-viz.radar_chart.areasOpacity">0.35</option>
        <option name="custom-radar-chart-viz.radar_chart.axesLabelFontColor">#737373</option>
        <option name="custom-radar-chart-viz.radar_chart.axesLegendFontColor">#000000</option>
        <option name="custom-radar-chart-viz.radar_chart.axesLineColor">#FFFFFF</option>
        <option name="custom-radar-chart-viz.radar_chart.chartHeight">500</option>
        <option name="custom-radar-chart-viz.radar_chart.chartWidth">500</option>
        <option name="custom-radar-chart-viz.radar_chart.circlesColor">#CDCDCD</option>
        <option name="custom-radar-chart-viz.radar_chart.circlesFillColor">#ffffff</option>
        <option name="custom-radar-chart-viz.radar_chart.circlesOpacity">0.1</option>
        <option name="custom-radar-chart-viz.radar_chart.format">.0f</option>
        <option name="custom-radar-chart-viz.radar_chart.fullScreen">0</option>
        <option name="custom-radar-chart-viz.radar_chart.isRounded">0</option>
        <option name="custom-radar-chart-viz.radar_chart.legendEnabled">1</option>
        <option name="custom-radar-chart-viz.radar_chart.legendFontColor">#000000</option>
        <option name="custom-radar-chart-viz.radar_chart.legendPositionX">25</option>
        <option name="custom-radar-chart-viz.radar_chart.legendPositionY">25</option>
        <option name="custom-radar-chart-viz.radar_chart.legendSymbol">cross</option>
        <option name="custom-radar-chart-viz.radar_chart.legendToggleSymbol">circle</option>
        <option name="custom-radar-chart-viz.radar_chart.levels">10</option>
        <option name="custom-radar-chart-viz.radar_chart.maxValue"></option>
        <option name="drilldown">none</option>
        <option name="height">466</option>
        <option name="refresh.display">progressbar</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row id="row1_col4">
    <panel depends="$sankey$">
      <title>Content from App &gt; Data Source &gt; MITRE ATT&amp;CK Tactic &gt; Status</title>
      <input type="dropdown" token="phase">
        <label>Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <fieldForLabel>LongName</fieldForLabel>
        <fieldForValue>LongName</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| rex field=Key "(?&lt;phase&gt;.*)(Long|Short)Name"
| stats first(Value) AS LongName, Last(Value) AS ShortName BY phase
| fields - phase</query>
        </search>
      </input>
      <input type="checkbox" token="show_recommended_only" searchWhenChanged="true">
        <label>Featured</label>
        <choice value="AND highlight=&quot;Yes&quot;">Yes</choice>
        <change>
          <eval token="form.highlight">if(isnull('form.show_recommended_only') OR NOT like('form.show_recommended_only',"%Yes%"), "*","Yes")</eval>
        </change>
        <default>AND 1=1</default>
        <delimiter> </delimiter>
      </input>
      <input type="checkbox" token="show_bookmarked_only" searchWhenChanged="true">
        <label>Bookmarked</label>
        <choice value="AND bookmark_status!=&quot;none&quot;">Yes</choice>
        <change>
          <eval token="form.bookmark_status">if(isnull('form.show_bookmarked_only') OR NOT like('form.show_bookmarked_only',"%none%"), "*","Yes")</eval>
        </change>
        <default>AND 1=1</default>
        <delimiter> </delimiter>
      </input>
      <input type="multiselect" token="datasource_selection">
        <label>Highlight Data Source</label>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <choice value="*">None</choice>
        <default>*</default>
        <valuePrefix>"</valuePrefix>
        <delimiter>,</delimiter>
        <valueSuffix>"</valueSuffix>
      </input>
      <viz type="sankey_diagram_app.sankey_diagram">
        <title>(Requires Sankey Viz)</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| eval "Use Case"='Use Case Orig'
               | foreach Enabled Hosts "Data Source" App "Data Source" "MITRE Tactic" Status  [
             | eval "&lt;&lt;FIELD&gt;&gt;"=coalesce('&lt;&lt;FIELD&gt;&gt;',"-")
            ]
            | search Status="$phase$"
            | appendpipe [| stats count(eval('$y_field$'="$Phase1LongName$")) AS "$y_field$_l1", count AS l1 by App "Data Source"]
| appendpipe [| stats count(eval('$y_field$'="$Phase1LongName$")) AS "$y_field$_l2", count AS l2 by "Data Source" "MITRE Tactic"]
| appendpipe [| stats count(eval('$y_field$'="$Phase1LongName$")) AS "$y_field$_l3", count AS l3 by "MITRE Tactic" "$y_field$"]
| table App "Data Source" "MITRE Tactic" "$y_field$" l1 l2 l3 "$y_field$_l1" "$y_field$_l2" "$y_field$_l3"
| eval LinkSource=case(isnotnull(l1), App, isnotnull(l2), 'Data Source', isnotnull(l3), 'MITRE Tactic', 1=1,null)
| eval LinkDestination=case(isnotnull(l1), 'Data Source', isnotnull(l2), 'MITRE Tactic', isnotnull(l3), '$y_field$', 1=1,null)
| eval count=coalesce(l1,l2,l3)
| where isnotnull(l1) OR isnotnull(l2) OR isnotnull(l3)
| table LinkSource LinkDestination count</query>
        </search>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="sankey_diagram_app.sankey_diagram.colorMode">sequential</option>
        <option name="sankey_diagram_app.sankey_diagram.maxColor">#$Phase0Color$</option>
        <option name="sankey_diagram_app.sankey_diagram.minColor">#F5F8F6</option>
        <option name="sankey_diagram_app.sankey_diagram.numOfBins">9</option>
        <option name="sankey_diagram_app.sankey_diagram.showLegend">true</option>
        <option name="sankey_diagram_app.sankey_diagram.useColors">true</option>
        <option name="trellis.enabled">0</option>
        <option name="trellis.scales.shared">1</option>
        <option name="trellis.size">medium</option>
      </viz>
    </panel>
  </row>
  <row id="row1_col5">
    <panel>
      <title>Security Journey</title>
    </panel>
  </row>
  <row id="row1_col6">
    <panel>
      <title>Stage 1</title>
      <chart id="stage_1_bar">
        <search base="usecase_base" id="stage_1_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_1" $show_recommended_only$
| chart count over Journey by Status
| eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| table Journey Active Available "Needs data" "Selected"
| fillnull Journey Active Available "Needs data" "Selected"
| eval Total=Active+Available+'Needs data'+Selected
| eval Perc_Selected=round((Selected/Total)*100,2)
| eval Perc_Active=round((Active/Total)*100,2)
| eval Perc_Available=round((Available/Total)*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active Perc_Selected</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">visible</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.showDataLabels">none</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Selected": 0x$SelectedColor$,"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.layout.splitSeries">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 2</title>
      <chart id="stage_2_bar">
        <search base="usecase_base" id="stage_2_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_2" $show_recommended_only$
| chart count over Journey by Status
| eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| table Journey Active Available "Needs data" "Selected"
| fillnull Journey Active Available "Needs data" "Selected"
| eval Total=Active+Available+'Needs data'+Selected
| eval Perc_Selected=round((Selected/Total)*100,2)
| eval Perc_Active=round((Active/Total)*100,2)
| eval Perc_Available=round((Available/Total)*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active Perc_Selected</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Selected": 0x$SelectedColor$,"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 3</title>
      <chart id="stage_3_bar">
        <search base="usecase_base" id="stage_3_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_3" $show_recommended_only$
| chart count over Journey by Status
| eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| table Journey Active Available "Needs data" "Selected"
| fillnull Journey Active Available "Needs data" "Selected"
| eval Total=Active+Available+'Needs data'+Selected
| eval Perc_Selected=round((Selected/Total)*100,2)
| eval Perc_Active=round((Active/Total)*100,2)
| eval Perc_Available=round((Available/Total)*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active Perc_Selected</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Selected": 0x$SelectedColor$,"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 4</title>
      <chart id="stage_4_bar">
        <search base="usecase_base" id="stage_4_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_4" $show_recommended_only$
| chart count over Journey by Status
| eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| table Journey Active Available "Needs data" "Selected"
| fillnull Journey Active Available "Needs data" "Selected"
| eval Total=Active+Available+'Needs data'+Selected
| eval Perc_Selected=round((Selected/Total)*100,2)
| eval Perc_Active=round((Active/Total)*100,2)
| eval Perc_Available=round((Available/Total)*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active Perc_Selected</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Selected": 0x$SelectedColor$,"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 5</title>
      <chart id="stage_5_bar">
        <search base="usecase_base" id="stage_5_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_5" $show_recommended_only$
| chart count over Journey by Status
| eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| table Journey Active Available "Needs data" "Selected"
| fillnull Journey Active Available "Needs data" "Selected"
| eval Total=Active+Available+'Needs data'+Selected
| eval Perc_Selected=round((Selected/Total)*100,2)
| eval Perc_Active=round((Active/Total)*100,2)
| eval Perc_Available=round((Available/Total)*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active Perc_Selected</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Selected": 0x$SelectedColor$,"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
    <panel>
      <title>Stage 6</title>
      <chart id="stage_6_bar">
        <search base="usecase_base" id="stage_6_base">
          <query>| eval Status=if("$x_field$"!="AddOn" AND in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| where Journey="Stage_6" $show_recommended_only$
| chart count over Journey by Status
| eval "$SelectedLongName$_New"=case(isnotnull(datasource) AND in(datasource,$datasource_selection$), '$SelectedLongName$',isnotnull(datasource) AND NOT in(datasource,$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, '$Phase2LongName$'+'$SelectedLongName$', '$Phase2LongName$')
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| table Journey Active Available "Needs data" "Selected"
| fillnull Journey Active Available "Needs data" "Selected"
| eval Total=Active+Available+'Needs data'+Selected
| eval Perc_Selected=round((Selected/Total)*100,2)
| eval Perc_Active=round((Active/Total)*100,2)
| eval Perc_Available=round((Available/Total)*100,2)
| eval Perc_NotActive=100-Perc_Active-Perc_Available
| eval Status="Content"
| fields Status Perc_NotActive Perc_Available Perc_Active Perc_Selected</query>
        </search>
        <option name="charting.axisLabelsX.axisVisibility">hide</option>
        <option name="charting.axisLabelsX.majorLabelStyle.overflowMode">ellipsisNone</option>
        <option name="charting.axisLabelsX.majorLabelStyle.rotation">-45</option>
        <option name="charting.axisLabelsX.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsX.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsX.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.axisVisibility">hide</option>
        <option name="charting.axisLabelsY.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY.minorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.axisVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorLabelVisibility">hide</option>
        <option name="charting.axisLabelsY2.majorTickVisibility">hide</option>
        <option name="charting.axisLabelsY2.minorTickVisibility">hide</option>
        <option name="charting.axisTitleX.visibility">collapsed</option>
        <option name="charting.axisTitleY.visibility">collapsed</option>
        <option name="charting.axisTitleY2.visibility">collapsed</option>
        <option name="charting.axisY.abbreviation">none</option>
        <option name="charting.chart">column</option>
        <option name="charting.chart.stackMode">stacked100</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Selected": 0x$SelectedColor$,"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="charting.gridLinesX.showMajorLines">0</option>
        <option name="charting.gridLinesX.showMinorLines">0</option>
        <option name="charting.gridLinesY.showMajorLines">0</option>
        <option name="charting.gridLinesY.showMinorLines">0</option>
        <option name="charting.gridLinesY2.showMajorLines">0</option>
        <option name="charting.gridLinesY2.showMinorLines">0</option>
        <option name="charting.legend.labelStyle.overflowMode">ellipsisMiddle</option>
        <option name="charting.legend.placement">none</option>
        <option name="height">310</option>
        <option name="refresh.display">progressbar</option>
      </chart>
    </panel>
  </row>
  <row id="row1_col7">
    <panel>
      <single>
        <search base="stage_1_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_2_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_3_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_4_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_5_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_6_base">
          <query>| fields Perc_Active</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase0LongName$</option>
        <option name="unit">%</option>
      </single>
    </panel>
  </row>
  <row id="row1_col8">
    <panel>
      <single>
        <search base="stage_1_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_2_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_3_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_4_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_5_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
      <single>
        <search base="stage_6_base">
          <query>| fields Perc_Available</query>
        </search>
        <option name="rangeColors">["0x53a051","0x0877a6","0xf8be34","0xf1813f","0xdc4e41"]</option>
        <option name="underLabel">$Phase1LongName$</option>
        <option name="unit">%</option>
      </single>
    </panel>
  </row>

  <row id="cs3">
    <panel>
      <title>Content selection</title>
      <input type="dropdown" token="phase">
        <label>Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <fieldForLabel>LongName</fieldForLabel>
        <fieldForValue>LongName</fieldForValue>
        <search>
          <query>| inputlookup AppSettings.csv
| rex field=Key "(?&lt;phase&gt;.*)(Long|Short)Name"
| stats first(Value) AS LongName, Last(Value) AS ShortName BY phase
| fields - phase</query>
        </search>
        <change>
          <condition label="Active">
            <set token="deeplink_enabled">Yes</set>
            <set token="deeplink_data_available">Good|Mixed</set>
          </condition>
          <condition label="Available">
            <set token="deeplink_enabled">No</set>
            <set token="deeplink_data_available">Good|Mixed</set>
          </condition>
          <condition label="Needs data">
            <set token="deeplink_enabled">ALL</set>
            <set token="deeplink_data_available">Unknown|Bad</set>
          </condition>
          <condition label="*">
            <set token="deeplink_enabled">ALL</set>
            <set token="deeplink_data_available">ALL</set>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="app">
        <label>Originating app</label>
        <fieldForLabel>App</fieldForLabel>
        <fieldForValue>App</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by App | fields App | sort 0 App</query>
        </search>
        <choice value="*">Any</choice>
        <default>*</default>
        <change>
          <condition label="Any">
            <set token="deeplink_displayapp">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_displayapp">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="MITRE_Tactic">
        <label>MITRE ATT&amp;CK Tactic</label>
        <fieldForLabel>MITRE_Tactic_Label</fieldForLabel>
        <fieldForValue>MITRE Tactic</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by "MITRE Tactic"
| fields "MITRE Tactic"
| eval MITRE_Tactic_Label='MITRE Tactic'
| sort 0 "MITRE_Tactic_Label"</query>
        </search>
        <choice value="*">Any</choice>
        <default>*</default>
        <change>
          <condition label="Any">
            <set token="deeplink_mitre_tactic_display">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_mitre_tactic_display">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="MITRE_Technique">
        <label>MITRE ATT&amp;CK Technique</label>
        <fieldForLabel>MITRE_Technique_Label</fieldForLabel>
        <fieldForValue>MITRE Technique</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by "MITRE Technique"
| fields "MITRE Technique"
| sort 0 "MITRE_Technique_Label"</query>
        </search>
        <choice value="*">Any</choice>
        <default>*</default>
        <change>
          <condition label="Any">
            <set token="deeplink_mitre_technique_display">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_mitre_technique_display">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="MITRE_Threat_Group">
        <label>MITRE ATT&amp;CK Threat Group</label>
        <fieldForLabel>MITRE_Threat_Group_Label</fieldForLabel>
        <fieldForValue>MITRE Threat Group</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by "MITRE Threat Group"
| fields "MITRE Threat Group"
| sort 0 "MITRE Threat Group"</query>
        </search>
        <choice value="*">Any</choice>
        <default>*</default>
        <change>
          <condition label="Any">
            <set token="deeplink_mitre_threat_groups">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_mitre_threat_groups">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="datasource">
        <label>Data Source</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>datasource</fieldForLabel>
        <fieldForValue>datasource</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by datasource | fields datasource | sort 0 datasource</query>
        </search>
        <change>
          <condition label="Any">
            <set token="deeplink_datasource">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_datasource">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="datacategory">
        <label>Data Source Category</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>Data Source Category</fieldForLabel>
        <fieldForValue>Data Source Category</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by "Data Source Category" | fields "Data Source Category" | sort 0 "Data Source Category"</query>
        </search>
        <change>
          <condition label="Any">
            <set token="deeplink_data_source_categories_display">ALL</set>
          </condition>
          <condition label="*">
            <eval token="deeplink_data_source_categories_display">replace($value$, " ", "_")</eval>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="bookmark_status">
        <label>Bookmark Status</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>bookmark_status_display</fieldForLabel>
        <fieldForValue>bookmark_status</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by bookmark_status,bookmark_status_display | fields bookmark_status bookmark_status_display
| sort 0 bookmark_status_display
| dedup bookmark_status</query>
        </search>
        <change>
          <condition label="Any">
            <set token="deeplink_bookmark_status">ALL</set>
          </condition>
          <condition label="*">
            <set token="deeplink_bookmark_status">$value$</set>
          </condition>
        </change>
      </input>
      <input type="dropdown" token="highlight">
        <label>Featured</label>
        <choice value="*">Any</choice>
        <default>*</default>
        <initialValue>*</initialValue>
        <fieldForLabel>highlight</fieldForLabel>
        <fieldForValue>highlight</fieldForValue>
        <search base="usecase_base">
          <query>| stats count by highlight | fields highlight | sort 0 highlight</query>
        </search>
        <change>
          <condition label="Yes">
            <set token="deeplink_highlight">Yes</set>
          </condition>
          <condition label="Any">
            <set token="deeplink_highlight">ALL</set>
          </condition>
          <condition label="*">
            <set token="deeplink_highlight">$value$</set>
          </condition>
        </change>
      </input>
      <input type="text" token="searchfilter">
        <label>Search Filter</label>
        <default></default>
        <change>
          <condition value="*">
            <set token="deeplink_search">$value$</set>
          </condition>
        </change>
      </input>
    </panel>
  </row>
  <row id="tabs_content_table">
    <panel>
      <html>
      <h1 data-translate-id="contentanalytics-h1-sectiontwo">2. Selected Content</h1>
      <p data-translate-id="contentanalytics-p-sectiontwodescription">Use the drop downs or tables to further filter your selection. </p>
      <ul id="tabs" class="nav nav-tabs">
                    <li class="active">
                        <a href="#" class="toggle-tab selected_content" data-toggle="tab" data-tab-set="selected_content" data-elements="selected_content_row2_col1" data-token="selected_content_row2_col1" data-translate-id="contentanalytics-li-selection">Selection</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab selected_content" data-toggle="tab" data-tab-set="selected_content" data-elements="selected_content_row2_col2" data-token="selected_content_row2_col2" data-translate-id="contentanalytics-li-contentlist">Content list</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab selected_content" data-toggle="tab" data-tab-set="selected_content" data-elements="selected_content_row2_col3" data-token="selected_content_row2_col3" data-translate-id="contentanalytics-li-datasource">Selection by Data Source</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab selected_content" data-toggle="tab" data-tab-set="selected_content" data-elements="selected_content_row2_col4" data-token="selected_content_row2_col4" data-translate-id="contentanalytics-li-datasourcecategory">Selection by Data Source Category</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab selected_content" data-toggle="tab" data-tab-set="selected_content" data-elements="selected_content_row2_col5" data-token="selected_content_row2_col5" data-translate-id="contentanalytics-li-mitretactic">Selection by MITRE ATT&amp;CK Tactic</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab selected_content" data-toggle="tab" data-tab-set="selected_content" data-elements="selected_content_row2_col6" data-token="selected_content_row2_col6" data-translate-id="contentanalytics-li-mitretechnique">Selection by MITRE ATT&amp;CK Technique</a>
                    </li>
                    <li>
                        <a href="#" class="toggle-tab selected_content" data-toggle="tab" data-tab-set="selected_content" data-elements="selected_content_row2_col7" data-token="selected_content_row2_col7" data-translate-id="contentanalytics-li-mitrethreatgroup">Selection by MITRE Threat Group</a>
                    </li>
				</ul>
    </html>
    </panel>
  </row>
  <row id="selected_content_row2_col1">
    <panel>
      <title></title>
      <single>
        <title>Total Selected</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| stats
count</query>
        </search>
        <option name="refresh.display">progressbar</option>
      </single>
    </panel>
    <panel>
      <chart>
        <title>Selection by Status</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "Data Source"
| where 'Data Source'!="-"
| stats
count by Status</query>
        </search>
        <option name="charting.chart">pie</option>
        <option name="charting.drilldown">all</option>
        <option name="charting.fieldColors">{"Perc_Available": 0x$Phase1Color$,"Perc_Active": 0x$Phase0Color$,"Perc_NotActive": 0xe1e6eb,"$Phase0LongName$": 0x$Phase0Color$, "$Phase1LongName$": 0x$Phase1Color$, "$Phase2LongName$":0x$Phase2Color$, "Yes":0x$Phase0Color$, "No":0x$Phase2Color$, "Enabled":0x$Phase0Color$, "Disabled":0x$Phase2Color$,"$SelectedLongName$":0x$SelectedColor$,"$SelectedShortName$":0x$SelectedColor$}</option>
        <option name="refresh.display">progressbar</option>
        <drilldown>
          <set token="form.phase">$row.Status$</set>
        </drilldown>
      </chart>
    </panel>
  </row>
  <row id="selected_content_row2_col2">
    <panel>
      <table id="content_table">
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort Journey
| eval "Use Case"='Use Case Orig',"Bookmark Status"=bookmark_status_display, Featured=highlight, "Data Availability"=data_available,Enabled=enabled,"Data Coverage"=data_available_numeric
| eval "Data Source"=mvdedup('Data Source')
| table Journey Status Title Description "Data Source" "Data Source Category" "Use Case" "MITRE Tactic" "MITRE Technique" App "Bookmark Status" Featured Enabled "Data Availability" "Data Coverage"</query>
        </search>
        <option name="count">5</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">none</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">true</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#1836DE" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Active">
          <colorPalette type="list">[#1836DE]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="Available">
          <colorPalette type="minMidMax" maxColor="#0D6AEB" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Needs data">
          <colorPalette type="minMidMax" maxColor="#00A9F8" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Selected">
          <colorPalette type="minMidMax" maxColor="#F1C40F" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="Selected">
          <colorPalette type="minMidMax" maxColor="#F1C40F" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="Data Coverage">
          <option name="precision">0</option>
          <option name="unit">%</option>
        </format>
        <format type="color" field="Status">
          <colorPalette type="map">{"Perc_Available":#73D0FB,"Perc_Active":#00A9F8,"Perc_NotActive":#E1E6EB,"Active":#00A9F8,"Available":#73D0FB,"Needs data":#BFEAFD,"Yes":#00A9F8,"No":#BFEAFD,"Enabled":#00A9F8,"Disabled":#BFEAFD,"Selected":#49B849}</colorPalette>
        </format>
      </table>
    </panel>
  </row>
  <row id="selected_content_row2_col3">
    <panel>
      <table id="datasource_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "Data Source"
| where 'Data Source'!="-"
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$",
values(data_source_categories) AS data_source_categories
BY "Data Source"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'

| join "Data Source" type=outer [
| sseanalytics
| fields datasource data_available_numeric data_source_categories
| eval c=mvcount(datasource)
| stats max(c) AS c,max(data_available_numeric) AS data_available_numeric by datasource, data_source_categories
| where
case(
datasource="AWS" AND like(data_source_categories,"VendorSpecific-aws%"),1,
datasource="Anti-Virus / Anti-Malware" AND like(data_source_categories,"DS004EndPointAntiMalware%"),1,
datasource="Any Splunk Logs" AND (like(data_source_categories,"VendorSpecific-AnySplunk%") OR like(data_source_categories,"VendorSpecific-SplunkInternal%")),1,
datasource="Application Data" AND (like(data_source_categories,"DS034ApplicationLogs%") OR like(data_source_categories,"VendorSpecific-sfdc%")),1,
datasource="Audit Trail" AND (like(data_source_categories,"VendorSpecific-Box%") OR like(data_source_categories,"VendorSpecific-sfdc-elf%") OR like(data_source_categories,"VendorSpecific-Cerner%")),1,
datasource="Authentication" AND like(data_source_categories,"DS003Authentication%"),1,
datasource="Azure" AND like(data_source_categories,"VendorSpecific-azure%"),1,
datasource="Backup" AND like(data_source_categories,"DS027EndpointBackup%"),1,
datasource="Configuration Management" AND like(data_source_categories,"DS015ConfigurationManagement%"),1,
datasource="DLP" AND like(data_source_categories,"DS016DataLossPrevention%"),1,
datasource="DNS" AND like(data_source_categories,"DS002DNS%"),1,
datasource="Email" AND like(data_source_categories,"DS001MAIL%"),1,
datasource="Endpoint Detection and Response" AND like(data_source_categories,"DS009EndPointIntel%"),1,
datasource="GCP" AND like(data_source_categories,"VendorSpecific-gcp%"),1,
datasource="Host-based IDS" AND like(data_source_categories,"DS020HostIntrustionDetection%"),1,
datasource="IDS or IPS" AND like(data_source_categories,"DS012NetworkIntrusionDetection%"),1,
datasource="IP Address Assignment" AND like(data_source_categories,"DS025IPAddressAssignment%"),1,
datasource="Malware Analysis" AND like(data_source_categories,"DS011MalwareDetonation%"),1,
datasource="Network Communication" AND like(data_source_categories,"DS010NetworkCommunication%"),1,
datasource="Patch Management" AND like(data_source_categories,"DS019PatchManagement%"),1,
datasource="Ticket Management" AND like(data_source_categories,"DS013TicketManagement%"),1,
datasource="User Activity Audit" AND like(data_source_categories,"DS006UserActivity%"),1,
datasource="VPN",1,
datasource="Vulnerability Detection" AND like(data_source_categories,"DS018VulnerabilityDetection%"),1,
datasource="Web Proxy" AND like(data_source_categories,"DS005WebProxyRequest%"),1,
datasource="Web Server" AND like(data_source_categories,"DS014WebServer%"),1,
datasource="Windows Security" AND like(data_source_categories,"VendorSpecific-winsec%"),1,
c=1,1
)=1
| join data_source_categories type=outer [
| inputlookup data_inventory_eventtypes_lookup
| fields - coverage_level
| join eventtypeId type=outer
    [
    | inputlookup data_inventory_products_lookup
| eval eventtypeId=split(eventtypeId,"|")
| mvexpand eventtypeId
| rename coverage_level AS coverage_level_product
| where isnotnull(coverage_level_product)
| dedup eventtypeId
| fields eventtypeId coverage_level_product
        ]
| eval coverage_level=coalesce(coverage_level_product,coverage_level,0)
| fields eventtypeId coverage_level
| rename eventtypeId AS data_source_categories
| fields data_source_categories coverage_level
]
| eval data_available_numeric=coalesce(coverage_level,0)
| eval "Data Source Category"=data_source_categories+" ("+data_available_numeric+"%)"
| fields c datasource "Data Source Category"
| stats delim="," values("Data Source Category") AS "Data Source Category" BY datasource
| rename datasource AS "Data Source"
]
| makemv delim="," "Data Source Category"

| sort - Total
| table "Data Source" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$" "Data Source Category"</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.datasource">$row.Data Source$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="selected_content_row2_col4">
    <panel>
      <table id="datacategory_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| eval data_source_categories_merge=data_source_categories."::".data_source_categories_display
| mvexpand data_source_categories_merge
| rex field="data_source_categories_merge" "(?&lt;data_source_categories>[^:]*)::(?&lt;data_source_categories_display>.*)"
| eval "Data Source Category"=data_source_categories_display
| where 'Data Source Category'!="-"
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "Data Source Category",data_source_categories,data_available

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| lookup data_inventory_eventtypes_lookup eventtypeId AS data_source_categories OUTPUT eventtypeId

| join eventtypeId type=outer
    [
    | inputlookup data_inventory_products_lookup
| eval eventtypeId=split(eventtypeId,"|")
| mvexpand eventtypeId
| where isnotnull(coverage_level)
| dedup eventtypeId
| fields eventtypeId coverage_level
        ]
| eval "Data Coverage"=coalesce(coverage_level,0)

| eval "Data Availability"=data_available
| sort - Total
| table "Data Source Category" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$" eventtypeId "Data Availability" "Data Coverage"</query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="number" field="Data Coverage">
          <option name="precision">0</option>
          <option name="unit">%</option>
        </format>
        <drilldown>
          <set token="form.datacategory">$row.Data Source Category$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="selected_content_row2_col5">
    <panel>
      <table id="mitre_tactic_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "MITRE Tactic"
| lookup mitre_matrix_list "Tactic" AS "MITRE Tactic" OUTPUT Matrix
| where Matrix="Enterprise ATT&amp;CK"
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "MITRE Tactic"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort - Total
| table "MITRE Tactic" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
| rename "MITRE Tactic" AS "MITRE ATT&amp;CK Tactic"
          </query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.MITRE_Tactic">$row.MITRE Tactic$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="selected_content_row2_col6">
    <panel>
      <table id="mitre_technique_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "MITRE Technique"
| lookup mitre_matrix_list "Technique" AS "MITRE Technique" OUTPUT Matrix
| where Matrix="Enterprise ATT&amp;CK"
| where 'MITRE Technique'!=""
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "MITRE Technique"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort - Total
| table "MITRE Technique" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
| rename "MITRE Technique" AS "MITRE ATT&amp;CK Technique"
          </query>
        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.MITRE_Technique">$row.MITRE Technique$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row id="selected_content_row2_col7">
    <panel>
      <table id="mitre_threat_group_table">
        <title>Click to filter</title>
        <search base="usecase_base">
          <query>| eval Status=if(in(datasource,$datasource_selection$), "$SelectedLongName$",Status)
| search Status="$phase$" "App"="$app$" "Data Source"="$datasource$" "Data Source Category"="$datacategory$" "bookmark_status"="$bookmark_status$" "highlight"="$highlight$" "MITRE Tactic"="$MITRE_Tactic$" "MITRE Technique"="$MITRE_Technique$" "MITRE Threat Group"="$MITRE_Threat_Group$"
| where like(lower(Title),"%".lower("$searchfilter$")."%") OR like(lower(Description),"%".lower("$searchfilter$")."%") OR like(lower('Data Source'),"%".lower("$searchfilter$")."%") OR like(lower('Data Source Category'),"%".lower("$searchfilter$")."%") OR like(lower('Use Case'),"%".lower("$searchfilter$")."%")
| mvexpand "MITRE Threat Group"
| where 'MITRE Threat Group'!=""
| stats
sum(eval(if(Status="$Phase0LongName$",1,0))) AS $Phase0LongName$,
sum(eval(if(Status="$Phase1LongName$",1,0))) AS "$Phase1LongName$",
sum(eval(if(Status="$Phase2LongName$",1,0))) AS "$Phase2LongName$",
sum(eval(if(Status="$SelectedLongName$",1,0))) AS "$SelectedLongName$"
BY "MITRE Threat Group"

| eval "$SelectedLongName$_New"=case(isnotnull('Data Source') AND in('Data Source',$datasource_selection$), '$SelectedLongName$',isnotnull('Data Source') AND NOT in('Data Source',$datasource_selection$),0,1=1,'$SelectedLongName$')
| eval m="Move the overlapping entries to Phase 2 so they dont get lost while filtering"
| fields - m
| eval "$Phase2LongName$"=if('$SelectedLongName$_New'=0 AND '$SelectedLongName$'&gt;0, coalesce('$Phase2LongName$',0)+coalesce('$SelectedLongName$',0), coalesce('$Phase2LongName$',0))
| rename "$SelectedLongName$_New" AS "$SelectedLongName$"

| eval Total='$Phase0LongName$'+'$Phase1LongName$'+'$Phase2LongName$'+'$SelectedLongName$'
| sort - Total
| table "MITRE Threat Group" Total "$Phase0LongName$" "$Phase1LongName$" "$Phase2LongName$" "$SelectedLongName$"
| rename "MITRE Threat Group" AS "MITRE ATT&amp;CK Threat Group"
          </query>


        </search>
        <option name="count">10</option>
        <option name="dataOverlayMode">none</option>
        <option name="drilldown">cell</option>
        <option name="refresh.display">progressbar</option>
        <option name="rowNumbers">true</option>
        <option name="totalsRow">false</option>
        <format type="color" field="Total">
          <colorPalette type="minMidMax" maxColor="#$Phase0Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase0LongName$">
          <colorPalette type="list">[#$Phase0Color$]</colorPalette>
          <scale type="threshold"></scale>
        </format>
        <format type="color" field="$Phase1LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase1Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$Phase2LongName$">
          <colorPalette type="minMidMax" maxColor="#$Phase2Color$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedLongName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <format type="color" field="$SelectedShortName$">
          <colorPalette type="minMidMax" maxColor="#$SelectedColor$" minColor="#FFFFFF"></colorPalette>
          <scale type="minMidMax"></scale>
        </format>
        <drilldown>
          <set token="form.MITRE_Threat_Group">$row.MITRE Threat Group$</set>
        </drilldown>
      </table>
    </panel>
  </row>
  <row>
    <panel>
      <html>
          <h1 data-translate-id="contentanalytics-h1-sectionthree">3. View Content</h1>
      <p data-translate-id="contentanalytics-h1-sectionthreedescription">Click the button below to drill down in to the content. </p>
       <a class="btn btn-primary animatedbutton" target="_blank" role="button" data-unset-token="show_details" href="/app/Splunk_Security_Essentials/contents#mitre_technique_display=$deeplink_mitre_technique_display$&amp;mitre_tactic_display=$deeplink_mitre_tactic_display$&amp;mitre_threat_groups=$deeplink_mitre_threat_groups$&amp;highlight=$deeplink_highlight$&amp;bookmark_status=$deeplink_bookmark_status$&amp;displayapp=$deeplink_displayapp$&amp;datasource=$deeplink_datasource$&amp;data_source_categories_display=$deeplink_data_source_categories_display$&amp;enabled=$deeplink_enabled$&amp;data_available=$deeplink_data_available$&amp;search=$deeplink_search$">
          <span data-translate-id="contentanalytics-span-drilldowntosse">Drill down to content selection</span>
        </a>
    </html>
    </panel>
  </row>
</form>